<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Guy's Guide to Ladies</title>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<style>
  *{margin:0;padding:0;box-sizing:border-box}
  body{font-family:'Segoe UI',sans-serif;background:#0f0f0f;color:#fff;min-height:100vh}
  header{background:linear-gradient(135deg,#1a1a2e,#16213e);padding:20px;text-align:center;border-bottom:2px solid #e94560}
  header h1{font-size:1.8em;font-weight:900;letter-spacing:1px}
  header h1 span{color:#e94560}
  header p{color:#888;font-size:0.85em;margin-top:4px}
  nav{display:flex;background:#1a1a1a;border-bottom:1px solid #222}
  nav button{flex:1;padding:12px;background:none;border:none;color:#888;font-size:0.85em;cursor:pointer;font-weight:600;letter-spacing:.5px;text-transform:uppercase;transition:all .2s}
  nav button.active{color:#e94560;border-bottom:2px solid #e94560}
  nav button:hover{color:#fff}
  .page{display:none;padding:20px;max-width:600px;margin:0 auto}
  .page.active{display:block}

  /* Auth */
  #auth-screen{position:fixed;inset:0;background:#0f0f0f;z-index:100;display:flex;align-items:center;justify-content:center;padding:20px}
  .auth-card{background:#1a1a2e;border-radius:20px;padding:36px 30px;width:100%;max-width:400px;text-align:center}
  .auth-card .logo{font-size:3em;margin-bottom:12px}
  .auth-card h2{font-size:1.5em;font-weight:900;margin-bottom:6px}
  .auth-card h2 span{color:#e94560}
  .auth-card>p{color:#888;font-size:0.88em;margin-bottom:28px}
  .auth-tabs{display:flex;background:#0f0f0f;border-radius:10px;padding:4px;margin-bottom:24px}
  .auth-tab{flex:1;padding:10px;background:none;border:none;color:#888;cursor:pointer;border-radius:8px;font-weight:600;font-size:0.9em;transition:all .2s}
  .auth-tab.active{background:#e94560;color:#fff}
  label{display:block;color:#aaa;font-size:0.82em;margin-bottom:6px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;text-align:left}
  input{width:100%;padding:12px 16px;background:#0f0f0f;border:1px solid #333;border-radius:10px;color:#fff;font-size:1em;margin-bottom:16px;outline:none;font-family:inherit}
  input:focus{border-color:#e94560}
  .btn{background:#e94560;color:#fff;border:none;padding:14px 28px;border-radius:10px;font-size:1em;font-weight:700;cursor:pointer;width:100%;transition:background .2s;letter-spacing:.5px;margin-bottom:10px;display:block;font-family:inherit}
  .btn:hover{background:#c73652}
  .btn:disabled{opacity:.5;cursor:not-allowed}
  .btn-outline{background:transparent;border:2px solid #e94560;color:#e94560}
  .btn-outline:hover{background:#e94560;color:#fff}
  .btn-green{background:#1a6b1a;border:2px solid #44cc44;color:#44cc44}
  .btn-green:hover{background:#44cc44;color:#000}
  .btn-sm{padding:8px 16px;font-size:0.85em;width:auto;display:inline-block}
  .err{background:#3d0000;border:1px solid #cc0033;border-radius:8px;padding:10px 14px;color:#ff8888;font-size:0.85em;margin-bottom:14px;display:none;text-align:left}

  /* Dashboard */
  .phase-banner{border-radius:16px;padding:24px;margin-bottom:20px;text-align:center}
  .phase-banner h2{font-size:1em;text-transform:uppercase;letter-spacing:2px;opacity:.8}
  .phase-banner h3{font-size:2em;font-weight:900;margin:6px 0 4px}
  .phase-banner .day-badge{font-size:.9em;opacity:.7;margin-bottom:6px}
  .phase-banner .one-liner{font-size:.95em;font-style:italic;color:rgba(255,255,255,.85);margin:10px 0 6px;background:rgba(0,0,0,.25);border-radius:8px;padding:8px 14px;display:inline-block}
  .phase-banner .emoji{font-size:3em;margin-bottom:8px;display:block}
  .cycle-bar{background:#222;border-radius:100px;height:10px;margin:10px 0 4px;overflow:hidden}
  .cycle-bar-fill{height:100%;border-radius:100px}
  .cycle-meta{display:flex;justify-content:space-between;font-size:.75em;color:#666}
  .card{background:#1a1a1a;border-radius:14px;padding:20px;margin-bottom:16px;border-left:4px solid #e94560}
  .card h4{font-size:.8em;text-transform:uppercase;letter-spacing:1px;color:#e94560;margin-bottom:10px;font-weight:700}
  .card p{color:#ccc;line-height:1.6;font-size:.95em}
  .tip-list{list-style:none}
  .tip-list li{padding:8px 0;color:#ccc;font-size:.9em;border-bottom:1px solid #222;line-height:1.5}
  .tip-list li:last-child{border-bottom:none}
  .dont-say{background:#1a0a0a;border-left-color:#ff4444}
  .dont-say h4{color:#ff4444}
  .dont-item{background:#2a1111;border-radius:8px;padding:10px 14px;margin-bottom:8px;font-size:.88em;color:#ffaaaa;font-style:italic}
  .dont-item::before{content:'ğŸš« '}
  .win-points{background:#0a1a0a;border-left-color:#44cc44}
  .win-points h4{color:#44cc44}
  .phase-ref{background:#1a1a1a;border-radius:14px;padding:18px;margin-bottom:14px}
  .no-data{text-align:center;padding:60px 20px}
  .no-data .big{font-size:4em;margin-bottom:16px}
  .no-data p{color:#888;margin-bottom:24px}
  .history-item{background:#1a1a1a;border-radius:10px;padding:12px 16px;margin-bottom:10px;display:flex;justify-content:space-between;align-items:center;font-size:.9em}
  .del{background:none;border:none;color:#555;cursor:pointer;font-size:1.1em}
  .del:hover{color:#e94560}
  .learned-badge{background:#1a2a0a;border:1px solid #44cc44;border-radius:8px;padding:8px 12px;font-size:.82em;color:#aaffaa;margin-bottom:16px;text-align:center}
  .section-title{font-size:.8em;text-transform:uppercase;letter-spacing:1px;color:#666;margin:20px 0 10px;font-weight:700}
  hr{border:none;border-top:1px solid #222;margin:20px 0}
  .setup-card{background:#1a1a2e;border-radius:16px;padding:30px}
  .user-bar{display:flex;align-items:center;justify-content:space-between;background:#1a1a1a;border-radius:10px;padding:10px 16px;margin-bottom:20px;font-size:.85em}
  .user-bar span{color:#888}
  .tag{display:inline-block;background:#e94560;border-radius:6px;padding:2px 8px;font-size:.75em;font-weight:700;margin-left:8px;vertical-align:middle}
  .loading{text-align:center;padding:60px 20px;color:#888}
  .spinner{display:inline-block;width:32px;height:32px;border:3px solid #333;border-top-color:#e94560;border-radius:50%;animation:spin .8s linear infinite;margin-bottom:12px}
  @keyframes spin{to{transform:rotate(360deg)}}
  .emailjs-info{background:#1a1a0a;border:1px solid #665500;border-radius:10px;padding:14px;margin-bottom:16px;font-size:.82em;color:#ccaa44;line-height:1.6}
  .emailjs-info a{color:#ffcc44}
  footer{text-align:center;padding:20px;color:#333;font-size:.75em}
</style>
</head>
<body>

<!-- Auth Screen -->
<div id="auth-screen">
  <div class="auth-card">
    <div class="logo">ğŸ¯</div>
    <h2>GUY'S GUIDE TO <span>LADIES</span></h2>
    <p>Your daily relationship intelligence system</p>
    <div class="auth-tabs">
      <button class="auth-tab active" id="tab-login">Sign In</button>
      <button class="auth-tab" id="tab-signup">Create Account</button>
    </div>
    <div id="auth-err" class="err"></div>
    <div id="login-form">
      <label>Email</label>
      <input type="email" id="login-email" placeholder="you@example.com" />
      <label>Password</label>
      <input type="password" id="login-pass" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
      <button class="btn" id="btn-login">Sign In</button>
      <button class="btn btn-outline" id="btn-google-1">ğŸ”µ Continue with Google</button>
    </div>
    <div id="signup-form" style="display:none">
      <label>Your Name</label>
      <input type="text" id="signup-name" placeholder="e.g. Mike" />
      <label>Email</label>
      <input type="email" id="signup-email" placeholder="you@example.com" />
      <label>Password</label>
      <input type="password" id="signup-pass" placeholder="min 6 characters" />
      <button class="btn" id="btn-signup">Create Account</button>
      <button class="btn btn-outline" id="btn-google-2">ğŸ”µ Continue with Google</button>
    </div>
  </div>
</div>

<!-- Main App -->
<header>
  <h1>GUY'S GUIDE TO <span>LADIES</span></h1>
  <p>Your daily relationship intelligence system</p>
</header>
<nav>
  <button class="active" id="nav-dashboard">ğŸ“Š Today</button>
  <button id="nav-setup">âš™ï¸ Setup</button>
  <button id="nav-reference">ğŸ“– Guide</button>
</nav>
<div id="dashboard" class="page active"><div class="loading"><div class="spinner"></div><p>Loading...</p></div></div>
<div id="setup" class="page"></div>
<div id="reference" class="page"></div>
<footer>Made with â¤ï¸ for the guys who actually give a damn</footer>

<script>
// â”€â”€ Phase Data â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const PHASES = [
  { name:"Menstruation", days:[1,2,3,4,5], emoji:"ğŸ”´",
    color:"linear-gradient(135deg,#3d0000,#7a0020)",
    oneliner:"She's bleeding and her body is working overtime â€” be her safe haven today.",
    hormones:"Estrogen and progesterone are at their lowest. Her body is working hard. Energy is low, cramps may be real, and she may feel emotionally vulnerable.",
    mood:"Tired, sensitive, possibly in pain. She needs comfort, not challenges.",
    dos:["âœ… Be extra patient and understanding","âœ… Bring her comfort food or her favourite snack","âœ… Offer a heating pad or hot water bottle","âœ… Watch her favourite shows with her","âœ… Tell her she's doing great"],
    donts:["âŒ Don't ask to go on a guys trip","âŒ Don't bring up money or finances","âŒ Don't start any serious debates","âŒ Don't be dismissive of her pain"],
    notsay:["\"You're always like this once a month\"","\"It's just cramps, you'll be fine\"","\"Can I go out with the guys this weekend?\"","\"Why are you so moody?\"","\"Other girls don't make such a big deal about it\""],
    winpoints:["ğŸ’† Give her a back or foot massage without being asked","ğŸ« Surprise her with chocolate or her comfort food","ğŸ“º Set up a cosy night in â€” her choice of show","ğŸ› Draw her a warm bath"] },
  { name:"Follicular Phase", days:[6,7,8,9,10,11,12], emoji:"ğŸŒ¸",
    color:"linear-gradient(135deg,#0a2a3d,#0d4a6b)",
    oneliner:"She's energised and open-minded â€” your best window for big talks, new plans, and adventures.",
    hormones:"Estrogen is rising rapidly. This is her superpower phase â€” she feels energised, optimistic, social, and mentally sharp.",
    mood:"Happy, energetic, open-minded, extroverted. She's at her best and fun to be around.",
    dos:["âœ… Plan dates, outings, and new experiences","âœ… Have important conversations â€” budget, future plans, relationship goals","âœ… Introduce her to new friends or social situations","âœ… Great time to bring up a guys trip diplomatically","âœ… Try new restaurants, activities, adventures together"],
    donts:["âŒ Don't waste this window being boring","âŒ Don't avoid conversations you've been putting off","âŒ Don't take her great mood for granted"],
    notsay:["\"I don't feel like going out\"","\"Let's just stay home again\"","\"We can talk about that later\" (stop delaying!)","\"I forgot to make a reservation\""],
    winpoints:["ğŸ‰ Plan a spontaneous adventure or surprise outing","ğŸ’¬ Have that conversation you've been avoiding â€” she's receptive now","ğŸ½ï¸ Book a new restaurant she's been wanting to try","ğŸ¤ Introduce her to your friends or suggest a group hangout"] },
  { name:"Ovulation", days:[13,14,15], emoji:"ğŸ”¥",
    color:"linear-gradient(135deg,#3d1a00,#7a3500)",
    oneliner:"Peak confidence, peak libido â€” plan something romantic and be fully present.",
    hormones:"Estrogen peaks and LH surges. This is her most fertile window. Libido is at its absolute highest. She feels confident, attractive, and social.",
    mood:"Confident, flirty, energetic, passionate. She looks and feels her best.",
    dos:["âœ… Plan a romantic date â€” she'll be into it","âœ… Compliment her appearance genuinely","âœ… Be present and attentive â€” she wants connection","âœ… If trying for a baby â€” this is THE window","âœ… If not â€” be extra careful with protection"],
    donts:["âŒ Don't be distracted or on your phone on dates","âŒ Don't ignore her flirtatious energy","âŒ Don't bring up stressful topics"],
    notsay:["\"I'm too tired tonight\"","\"Can we talk about the credit card bill?\"","\"I'm just gonna hang with the guys\"","\"You look tired\""],
    winpoints:["ğŸ’ Buy her flowers â€” unexpected ones hit different right now","ğŸ“¸ Take her somewhere she'll want to post about","ğŸ‘— Compliment how she looks â€” be specific and genuine","ğŸŒ™ Plan an intentional, romantic evening"] },
  { name:"Early Luteal", days:[16,17,18], emoji:"ğŸ˜Œ",
    color:"linear-gradient(135deg,#2a1a3d,#4a2a6b)",
    oneliner:"The high is fading â€” slow down, tune in, and show up with small acts of care.",
    hormones:"Progesterone begins rising. The high of ovulation fades. She may start to feel slightly less energetic and more inward-focused.",
    mood:"Calmer, slightly more sensitive, starting to turn inward. Great time for quality one-on-one time.",
    dos:["âœ… Focus on quality time â€” cosy, low-key activities","âœ… Be a good listener â€” she may be more reflective","âœ… Give genuine compliments about who she is, not just looks","âœ… Check in on how she's feeling","âœ… Cook dinner or take over a chore without being asked"],
    donts:["âŒ Don't plan overly loud or crowded social events","âŒ Don't be dismissive if she seems quieter than usual","âŒ Don't neglect small acts of affection"],
    notsay:["\"What's wrong with you lately?\"","\"You seem off\"","\"I need you to be more fun\"","\"Stop being so sensitive\""],
    winpoints:["ğŸ³ Cook her favourite meal without being asked","ğŸ’Œ Send her a genuine thoughtful text during the day","ğŸ›‹ï¸ Plan a cosy night in with her favourite things","ğŸŒ¹ Small random gift â€” doesn't need to be big"] },
  { name:"PMS Phase", days:[19,20,21,22,23,24,25,26,27,28], emoji:"âš ï¸",
    color:"linear-gradient(135deg,#2a1a00,#4a2e00)",
    oneliner:"Her brain chemistry is literally shifting â€” patience isn't optional, it's your superpower right now.",
    hormones:"Progesterone drops significantly. Estrogen fluctuates. Serotonin dips. Her brain chemistry is literally changing. This is real, not drama.",
    mood:"Irritable, emotional, bloated, anxious, tired. Small things may feel big. She needs patience, not logic.",
    dos:["âœ… Listen without trying to fix everything","âœ… Give her space when she needs it â€” read the room","âœ… Be extra thoughtful â€” small gestures go a long way","âœ… Validate her feelings even when they seem disproportionate","âœ… Keep the house tidy â€” clutter adds to her stress"],
    donts:["âŒ Don't pick fights or bring up big issues","âŒ Don't plan anything requiring major decisions","âŒ Don't bring up budget or finances","âŒ Don't suggest she's acting irrationally","âŒ Don't invite her to big loud social events she didn't ask for"],
    notsay:["\"You're being irrational\"","\"Is it that time of the month again?\"","\"You need to calm down\"","\"I can't do anything right with you\"","\"You're overreacting\"","\"Have you gained weight?\" (NEVER. EVER.)"],
    winpoints:["ğŸ§˜ Give her space to decompress without making it weird","ğŸ• Order her favourite takeout, no questions asked","ğŸ’† Offer a massage â€” no expectations, just care","ğŸ A small thoughtful gift lands huge right now","ğŸ§¹ Clean the house or handle chores proactively"] }
];

const BAR_COLORS={"Menstruation":"#cc0033","Follicular Phase":"#0088cc","Ovulation":"#ff6600","Early Luteal":"#6633cc","PMS Phase":"#cc6600"};

// â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let auth, db, currentUser=null, userData={};

// â”€â”€ Init Firebase â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
firebase.initializeApp({
  apiKey:"AIzaSyBHZimT1Npa5gwzCk2KDQP4kS0R4IC2qRI",
  authDomain:"guys-guide-to-ladies.firebaseapp.com",
  projectId:"guys-guide-to-ladies",
  storageBucket:"guys-guide-to-ladies.firebasestorage.app",
  messagingSenderId:"883845849328",
  appId:"1:883845849328:web:e24f311dc30ef1b6b52235"
});
auth = firebase.auth();
db   = firebase.firestore();

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const $ = id => document.getElementById(id);
const showErr = msg => { const e=$('auth-err'); e.textContent=msg; e.style.display='block'; };
const hideErr = ()  => { $('auth-err').style.display='none'; };

function friendlyErr(code){
  return ({
    'auth/user-not-found':'No account found with that email.',
    'auth/wrong-password':'Incorrect password.',
    'auth/invalid-credential':'Incorrect email or password.',
    'auth/email-already-in-use':'An account with this email already exists.',
    'auth/weak-password':'Password must be at least 6 characters.',
    'auth/invalid-email':'Please enter a valid email address.',
    'auth/popup-closed-by-user':'Sign-in cancelled.',
    'auth/network-request-failed':'Network error. Check your connection.'
  })[code] || 'Something went wrong ('+code+'). Please try again.';
}

function getPhase(day,len){
  const d=Math.round(Math.min(day,len)/len*28);
  for(const p of PHASES) if(p.days.includes(d)) return p;
  return PHASES[4];
}

function calcLearned(){
  const h=(userData.history||[]).map(d=>new Date(d+'T12:00:00')).sort((a,b)=>a-b);
  if(h.length<2) return null;
  const diffs=[];
  for(let i=1;i<h.length;i++) diffs.push(Math.round((h[i]-h[i-1])/86400000));
  const v=diffs.filter(d=>d>=21&&d<=45);
  return v.length ? Math.round(v.reduce((a,b)=>a+b,0)/v.length) : null;
}

function getTodayInfo(){
  if(!userData.periodStart) return null;
  const len=parseInt(userData.cycleLength)||28;
  const today=new Date(); today.setHours(0,0,0,0);
  const sd=new Date(userData.periodStart+'T12:00:00'); sd.setHours(0,0,0,0);
  let day=(Math.floor((today-sd)/86400000)%len)+1;
  if(day<1) day=1;
  return {phase:getPhase(day,len),day,len};
}

// â”€â”€ Firestore â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function loadUserData(){
  const snap=await db.collection('users').doc(currentUser.uid).get();
  userData=snap.exists ? snap.data() : {};
}
async function saveUserData(updates){
  userData={...userData,...updates};
  await db.collection('users').doc(currentUser.uid).set(userData,{merge:true});
}

// â”€â”€ Auth â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(tab){
  hideErr();
  $('tab-login').classList.toggle('active',tab==='login');
  $('tab-signup').classList.toggle('active',tab==='signup');
  $('login-form').style.display  = tab==='login'  ? 'block':'none';
  $('signup-form').style.display = tab==='signup' ? 'block':'none';
}

async function doLogin(){
  hideErr();
  const email=$('login-email').value.trim(), pass=$('login-pass').value;
  if(!email||!pass){showErr('Please enter your email and password.');return;}
  $('btn-login').disabled=true; $('btn-login').textContent='Signing in...';
  try{ await auth.signInWithEmailAndPassword(email,pass); }
  catch(e){ showErr(friendlyErr(e.code)); $('btn-login').disabled=false; $('btn-login').textContent='Sign In'; }
}

async function doSignup(){
  hideErr();
  const name=$('signup-name').value.trim()||'Guy';
  const email=$('signup-email').value.trim(), pass=$('signup-pass').value;
  if(!email||!pass){showErr('Please fill in all fields.');return;}
  $('btn-signup').disabled=true; $('btn-signup').textContent='Creating account...';
  try{
    const cred=await auth.createUserWithEmailAndPassword(email,pass);
    await cred.user.updateProfile({displayName:name});
    await db.collection('users').doc(cred.user.uid).set({name,email,createdAt:new Date().toISOString()});
  }catch(e){ showErr(friendlyErr(e.code)); $('btn-signup').disabled=false; $('btn-signup').textContent='Create Account'; }
}

async function doGoogle(){
  hideErr();
  try{
    const provider=new firebase.auth.GoogleAuthProvider();
    const cred=await auth.signInWithPopup(provider);
    const ref=db.collection('users').doc(cred.user.uid);
    const snap=await ref.get();
    if(!snap.exists) await ref.set({name:cred.user.displayName||'Guy',email:cred.user.email,createdAt:new Date().toISOString()});
  }catch(e){ showErr(friendlyErr(e.code)); }
}

async function doSignOut(){ await auth.signOut(); userData={}; $('auth-screen').style.display='flex'; }

// â”€â”€ Auth State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
auth.onAuthStateChanged(async user=>{
  if(user){
    currentUser=user;
    $('auth-screen').style.display='none';
    await loadUserData();
    renderDashboard();
  } else {
    currentUser=null;
    $('auth-screen').style.display='flex';
  }
});

// â”€â”€ Dashboard â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDashboard(){
  const dash=$('dashboard'), info=getTodayInfo(), name=userData.herName||'Her';
  if(!info){
    dash.innerHTML=`<div class="no-data"><div class="big">ğŸ“‹</div><h3>No Cycle Tracked Yet</h3><p>Head to Setup to enter her cycle info.</p><button class="btn" id="go-setup">Get Started</button></div>`;
    $('go-setup').onclick=()=>showPage('setup');
    return;
  }
  const {phase,day,len}=info, pct=Math.round(day/len*100), bc=BAR_COLORS[phase.name]||'#e94560';
  dash.innerHTML=`
    <div class="user-bar"><span>ğŸ‘¤ <strong>${currentUser.displayName||currentUser.email}</strong></span><button class="btn btn-outline btn-sm" id="so-btn">Sign Out</button></div>
    <div class="phase-banner" style="background:${phase.color}">
      <span class="emoji">${phase.emoji}</span><h2>Tracking ${name}</h2><h3>${phase.name}</h3>
      <div class="day-badge">Day ${day} of ${len}</div>
      <div class="one-liner">"${phase.oneliner}"</div>
      <div class="cycle-bar"><div class="cycle-bar-fill" style="width:${pct}%;background:${bc}"></div></div>
      <div class="cycle-meta"><span>Day 1</span><span>${pct}% through cycle</span><span>Day ${len}</span></div>
    </div>
    <div class="card"><h4>ğŸ§¬ What's Happening Hormonally</h4><p>${phase.hormones}</p></div>
    <div class="card"><h4>ğŸ­ Mood & Energy Forecast</h4><p>${phase.mood}</p></div>
    <div class="card"><h4>âœ… Your Action Plan Today</h4><ul class="tip-list">${phase.dos.map(d=>`<li>${d}</li>`).join('')}</ul></div>
    <div class="card"><h4>ğŸš« Things to Avoid Today</h4><ul class="tip-list">${phase.donts.map(d=>`<li>${d}</li>`).join('')}</ul></div>
    <div class="card dont-say"><h4>ğŸ¤ What NOT to Say Right Now</h4>${phase.notsay.map(s=>`<div class="dont-item">${s}</div>`).join('')}</div>
    <div class="card win-points"><h4>ğŸ† Win Points â€” Do This Today</h4><ul class="tip-list">${phase.winpoints.map(w=>`<li>${w}</li>`).join('')}</ul></div>
    <button class="btn btn-outline" id="go-setup2" style="margin-bottom:20px">âš™ï¸ Update Cycle Info</button>`;
  $('so-btn').onclick=doSignOut;
  $('go-setup2').onclick=()=>showPage('setup');
}

// â”€â”€ Setup â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderSetup(){
  const learned=calcLearned(), h=(userData.history||[]).sort((a,b)=>new Date(b)-new Date(a));
  $('setup').innerHTML=`
    <div class="setup-card">
      <h2>Her Cycle Settings</h2>
      <p style="color:#888;margin-bottom:20px;font-size:.9em">Your data syncs across all your devices â˜ï¸</p>
      <label>Her Name</label>
      <input id="her-name" value="${userData.herName||''}" placeholder="e.g. Sarah" />
      <label>First Day of Most Recent Period</label>
      <input type="date" id="period-start" value="${userData.periodStart||''}" />
      <label>Cycle Length (days)${learned?' <span class="tag">ğŸ“ˆ LEARNED</span>':''}</label>
      <input type="number" id="cycle-length" value="${learned||userData.cycleLength||28}" min="21" max="45" />
      ${learned?`<div class="learned-badge">âœ… Auto-calculated from ${h.length} logged periods</div>`:''}
      <button class="btn" id="save-btn">ğŸ’¾ Save Settings</button>
      <hr>
      <div class="section-title">ğŸ“… Log New Period Start</div>
      <p style="color:#888;font-size:.85em;margin-bottom:14px">Log each new period so the app learns her real cycle length.</p>
      <label>New Period Start Date</label>
      <input type="date" id="new-period-date" />
      <button class="btn btn-outline" id="log-btn">â• Log Period Start</button>
      ${h.length?`
        <div class="section-title">ğŸ“… Period History (${h.length} logged)</div>
        ${learned?`<div class="learned-badge">ğŸ“ˆ Learned cycle: <strong>${learned} days</strong></div>`:''}
        ${h.map(d=>`<div class="history-item"><span>ğŸ”´ ${new Date(d+'T12:00:00').toLocaleDateString('en-US',{month:'long',day:'numeric',year:'numeric'})}</span><button class="del" data-date="${d}">ğŸ—‘ï¸</button></div>`).join('')}
      `:''}
      <hr>
      <div class="section-title">ğŸ”” Browser Notifications</div>
      <button class="btn btn-green" id="notif-btn">ğŸ”” Enable Browser Notifications</button>
      <hr>
      <div class="section-title">ğŸ“§ Email Reminders (EmailJS)</div>
      <div class="emailjs-info">Sign up free at <a href="https://emailjs.com" target="_blank">emailjs.com</a>, connect Gmail, create a template with <strong>{{phase}}, {{day}}, {{tip}}, {{not_say}}, {{her_name}}</strong></div>
      <label>Your Email</label>
      <input type="email" id="notify-email" value="${userData.notifyEmail||''}" placeholder="you@example.com" />
      <label>EmailJS Service ID</label>
      <input id="ejs-svc" value="${userData.ejsSvc||''}" placeholder="service_xxxxxxx" />
      <label>EmailJS Template ID</label>
      <input id="ejs-tmpl" value="${userData.ejsTmpl||''}" placeholder="template_xxxxxxx" />
      <label>EmailJS Public Key</label>
      <input id="ejs-key" value="${userData.ejsKey||''}" placeholder="xxxxxxxxxxxxxx" />
      <button class="btn btn-green" id="save-email-btn">ğŸ“§ Save Email Settings</button>
      <button class="btn btn-outline" id="test-email-btn">ğŸ§ª Send Test Email</button>
      <hr>
      <button class="btn btn-outline" id="so-btn2">ğŸšª Sign Out</button>
    </div>`;

  $('save-btn').onclick=async()=>{
    const herName=$('her-name').value||'Her', periodStart=$('period-start').value, cycleLength=parseInt($('cycle-length').value)||28;
    if(!periodStart){alert('Please enter the first day of her period.');return;}
    const h2=userData.history||[];
    if(!h2.includes(periodStart)) h2.push(periodStart);
    await saveUserData({herName,periodStart,cycleLength,history:h2});
    alert('âœ… Settings saved and synced!'); showPage('dashboard');
  };

  $('log-btn').onclick=async()=>{
    const d=$('new-period-date').value;
    if(!d){alert('Please enter a date.');return;}
    const h2=userData.history||[];
    if(!h2.includes(d)) h2.push(d);
    const sorted=[...h2].sort((a,b)=>new Date(b)-new Date(a));
    const lrn=calcLearned(); const upd={history:h2,periodStart:sorted[0]};
    if(lrn) upd.cycleLength=lrn;
    await saveUserData(upd);
    alert(`âœ… Period logged!${lrn?`\nğŸ“ˆ Learned cycle: ${lrn} days`:''}`);
    renderSetup();
  };

  document.querySelectorAll('.del').forEach(btn=>{
    btn.onclick=async()=>{
      const h2=(userData.history||[]).filter(d=>d!==btn.dataset.date);
      await saveUserData({history:h2}); renderSetup();
    };
  });

  $('notif-btn').onclick=()=>{
    if(!('Notification' in window)){alert('Notifications not supported in this browser.');return;}
    Notification.requestPermission().then(p=>{
      if(p==='granted'){
        const i=getTodayInfo();
        if(i) new Notification("Guy's Guide to Ladies ğŸ’ª",{body:`Day ${i.day} â€” ${i.phase.name}\n${i.phase.oneliner}`});
        alert('âœ… Browser notifications enabled!');
      }
    });
  };

  $('save-email-btn').onclick=async()=>{
    await saveUserData({notifyEmail:$('notify-email').value,ejsSvc:$('ejs-svc').value,ejsTmpl:$('ejs-tmpl').value,ejsKey:$('ejs-key').value});
    alert('âœ… Email settings saved!');
  };

  $('test-email-btn').onclick=()=>{
    const {notifyEmail:em,ejsSvc:sv,ejsTmpl:tm,ejsKey:ky}=userData;
    if(!em||!sv||!tm||!ky){alert('Fill in all EmailJS fields first.');return;}
    const i=getTodayInfo(); if(!i){alert('Set up her cycle first.');return;}
    emailjs.init(ky);
    emailjs.send(sv,tm,{to_email:em,her_name:userData.herName||'Her',phase:i.phase.name,day:i.day,one_liner:i.phase.oneliner,tip:i.phase.winpoints[0],not_say:i.phase.notsay[0]})
      .then(()=>alert('âœ… Test email sent!'),e=>alert('âŒ '+JSON.stringify(e)));
  };

  $('so-btn2').onclick=doSignOut;
}

// â”€â”€ Reference â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReference(){
  $('reference').innerHTML=`<h2 style="margin-bottom:16px;font-size:1.2em">ğŸ“– Complete Cycle Guide</h2>`+
    PHASES.map(p=>`
      <div class="phase-ref">
        <h3 style="margin-bottom:6px">${p.emoji} ${p.name} <span style="color:#666;font-size:.8em">(Days ${p.days[0]}â€“${p.days[p.days.length-1]})</span></h3>
        <p style="margin-bottom:6px;color:#ccc;font-style:italic">"${p.oneliner}"</p>
        <p style="margin-bottom:8px;color:#888;font-size:.85em;line-height:1.5">${p.hormones}</p>
        <p style="color:#ff6666;font-size:.82em;margin-bottom:4px">ğŸš« Never say: ${p.notsay[0]}</p>
        <p style="color:#44cc44;font-size:.82em">ğŸ† Win move: ${p.winpoints[0]}</p>
      </div>`).join('');
}

// â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  $(id).classList.add('active');
  $('nav-'+id).classList.add('active');
  if(id==='dashboard') renderDashboard();
  if(id==='setup')     renderSetup();
  if(id==='reference') renderReference();
}

// â”€â”€ Wire up buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
$('tab-login').onclick  = ()=>switchTab('login');
$('tab-signup').onclick = ()=>switchTab('signup');
$('btn-login').onclick   = doLogin;
$('btn-signup').onclick  = doSignup;
$('btn-google-1').onclick = doGoogle;
$('btn-google-2').onclick = doGoogle;
$('nav-dashboard').onclick = ()=>showPage('dashboard');
$('nav-setup').onclick     = ()=>showPage('setup');
$('nav-reference').onclick = ()=>showPage('reference');
</script>
</body>
</html>
